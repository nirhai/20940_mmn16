{% extends "base.html" %}
{% block container %}
    <form method="post" onsubmit="return submitForm">
        <label for="username"><input type="text" name="username" placeholder="Username" maxlength="25" required class="input-field"></label>
        <label for="password"><input type="password" name="password" placeholder="Password" maxlength="20" required class="input-field"></label>
        
        {% if captcha_required %}
        <label for="captcha"><input id="captcha" type="text" name="captcha" placeholder="CAPTCHA Token" maxlength="20" required class="input-field"></label>
        {% endif %}

        {% if totp_on %}
        <div class="parameter"><label for="2fa">
            <input id="2fa" type="checkbox" name="2fa" onchange="hideOTP()">Two-Factor Authentication
            <input id="otp" type="text" name="otp" placeholder="OTP" maxlength="20" hidden class="input-field">
        </label></div>
        {% endif %}

        <p id="msg" class="message">
            {% with messages = get_flashed_messages() %}
                {% if messages %}
                    {% for message in messages %}
                    {{ message }}<br>
                    {% endfor %}
                {% endif %}
            {% endwith %}
        </p>
        
        <div class="buttons">
            <button type="submit" formaction="{{ url_for('login') }}" {% if totp_on %} onclick="check2FA()" {% endif %} class="button button-login">Login</button>
            <button type="submit" formaction="{{ url_for('register') }}" {% if totp_on %} onclick="ignoreOTP()" {% endif %} class="button button-register">Register</button>
            {% if totp_on %}
            <a href="{{ url_for('otp_gen') }}" class="button">OTP Generator</a>
            {% endif %}
            {% if captcha_required %}
            <a href="{{ url_for('get_captcha_token', group_seed='496905569') }}" class="button">Get CAPTCHA Token</a>
            {% endif %}
            <a href="{{ url_for('config') }}" class="button">Set configuration</a>
            <a href="{{ url_for('attack') }}" class="button button-attack">Attack</a>
        </div>
    </form>
    {% if totp_on %}
    <script>
        var submitForm = true;

        function hideOTP() {
            let tfa = document.getElementById('2fa');
            if(!tfa.checked) {
                let otp = document.getElementById('otp');
                otp.hidden = true;
                otp.required = false;
                submitForm = true;
            }
        }

        function check2FA() {
            let tfa = document.getElementById('2fa');
            let otp = document.getElementById('otp');
            if(tfa.checked && otp.hidden) {
                otp.hidden = false;
                otp.required = true;
                submitForm = false;
            } else {
                submitForm = true;
            }
        }

        function ignoreOTP() {
            let otp = document.getElementById('otp');
            otp.required = false;
            submitForm = true;
        }
    </script>
    {% endif %}
{% endblock %}